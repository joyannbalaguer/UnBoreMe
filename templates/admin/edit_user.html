{% extends "base.html" %}

{% block title %}Edit User - UnBoreMe {{ user.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="display-5"><i class="fas fa-user-edit"></i> Edit User</h1>
            <p class="lead">Editing profile for <strong>{{ user.username }}</strong></p>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <a href="{{ url_for('admin.view_user', user_id=user.id) }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to User Details
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-warning text-dark">  
                    <h5 class="mb-0"><i class="fas fa-edit"></i> Update User Information</h5>
                </div>
                <div class="card-body">

                    <form id="editUserForm" method="POST" action="{{ url_for('admin.edit_user', user_id=user.id) }}">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="firstname" class="form-label">First Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="firstname" name="firstname"
                                       value="{{ user.firstname }}" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="middlename" class="form-label">Middle Name</label>
                                <input type="text" class="form-control" id="middlename" name="middlename"
                                       value="{{ user.middlename or '' }}">
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="lastname" class="form-label">Last Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="lastname" name="lastname"
                                       value="{{ user.lastname }}" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="birthday" class="form-label">Birthday</label>
                                <input type="date" class="form-control" id="birthday" name="birthday"
                                       value="{{ user.birthday if user.birthday else '' }}">
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="contact" class="form-label">Contact Number</label>
                                <input type="text" class="form-control" id="contact" name="contact"
                                       value="{{ user.contact or '' }}">
                            </div>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="button" id="confirmUpdateBtn" class="btn btn-warning btn-lg">
                                <i class="fas fa-save"></i> Update User
                            </button>
                            <a href="{{ url_for('admin.view_user', user_id=user.id) }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- SweetAlert2 (include once per site; safe to leave if not included elsewhere) -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Confirm dialog script with dark-mode-friendly styles -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const updateBtn = document.getElementById("confirmUpdateBtn");
    const form = document.getElementById("editUserForm");

    function openConfirm(options, onConfirm) {
        const defaults = {
            showCancelButton: true,
            cancelButtonText: "Cancel",
            confirmButtonText: "Yes, update",
            background: "#12121a",
            color: "#ffffff",
            customClass: {
                popup: 'swal2-popup-dark',
                title: 'swal2-title-dark',
                content: 'swal2-content-dark',
                confirmButton: 'swal2-confirm-dark',
                cancelButton: 'swal2-cancel-dark'
            }
        };
        Swal.fire(Object.assign({}, defaults, options)).then((result) => {
            if (result.isConfirmed && typeof onConfirm === 'function') onConfirm();
        });
    }

    if (updateBtn && form) {
        updateBtn.addEventListener("click", function () {
            openConfirm({
                title: "Are you sure?",
                text: "Do you want to update this user's information?",
                icon: "warning",
                confirmButtonText: "Yes, update",
                cancelButtonText: "Cancel"
            }, function () {
                form.submit();
            });
        });
    }
});
</script>

<style>
/* Ensure SweetAlert appears above everything and is visible on dark themes */
.swal2-container { z-index: 99999 !important; }

.swal2-popup.swal2-popup-dark {
    background: #12121a !important;
    color: #e9eef6 !important;
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
}

.swal2-title-dark {
    color: #ffffff !important;
    font-weight: 600;
}

.swal2-content-dark {
    color: #dfe7ee !important;
}

.swal2-confirm-dark {
    background-color: #f0ad4e !important;
    color: #111 !important;
    border: none !important;
}

.swal2-cancel-dark {
    background-color: #6c757d !important;
    color: #fff !important;
    border: none !important;
}

.swal2-confirm-dark:hover, .swal2-cancel-dark:hover {
    filter: brightness(0.95);
}
</style>

{% endblock %}

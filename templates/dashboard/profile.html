{% extends "base.html" %}

{% block title %}Edit Profile - UnBoreMe{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-container">
        <div class="profile-header">
            <h1 class="neon-text">Edit Profile</h1>
            <p>Update your personal information</p>
        </div>

        <div class="profile-content glass">
            <!-- PROFILE EDIT FORM -->
            <form method="POST"
                  action="{{ url_for('dashboard.edit_profile') }}"
                  class="profile-form"
                  id="profileForm">

                <div class="form-section">
                    <h3>Personal Information</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>First Name <span class="required">*</span></label>
                            <input type="text"
                                   name="firstname"
                                   class="form-control glass"
                                   value="{{ user.firstname }}"
                                   required>
                        </div>

                        <div class="form-group">
                            <label>Middle Name</label>
                            <input type="text"
                                   name="middlename"
                                   class="form-control glass"
                                   value="{{ user.middlename or '' }}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text"
                               name="lastname"
                               class="form-control glass"
                               value="{{ user.lastname }}"
                               required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Birthday</label>
                            <input type="date"
                                   name="birthday"
                                   class="form-control glass"
                                   value="{{ user.birthday or '' }}">
                        </div>

                        <div class="form-group">
                            <label>Contact Number</label>
                            <input type="tel"
                                   name="contact"
                                   class="form-control glass"
                                   value="{{ user.contact or '' }}"
                                   placeholder="+63 912 345 6789">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Account Information</h3>

                    <div class="form-group">
                        <label>Username</label>
                        <input type="text"
                               class="form-control glass"
                               value="{{ user.username }}"
                               disabled>
                        <small>Username cannot be changed</small>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email"
                               class="form-control glass"
                               value="{{ user.email }}"
                               disabled>
                        <small>Email cannot be changed</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button"
                            class="btn btn-primary glow"
                            onclick="confirmProfileSave()">
                        Save Changes
                    </button>
                    <a href="{{ url_for('dashboard.index') }}"
                       class="btn btn-secondary">
                        Cancel
                    </a>
                </div>
            </form>

            <!-- CHANGE PASSWORD -->
            <div class="password-section" style="margin-top:2rem;">
                <h3>Change Password</h3>

                <form method="POST"
                      action="{{ url_for('dashboard.change_password') }}"
                      id="passwordForm">

                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password"
                               name="current_password"
                               class="form-control glass"
                               required>
                    </div>

                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password"
                               id="new_password"
                               name="new_password"
                               class="form-control glass"
                               minlength="8"
                               required>
                        <small>Minimum 8 characters</small>
                    </div>

                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password"
                               id="confirm_new_password"
                               name="confirm_new_password"
                               class="form-control glass"
                               minlength="8"
                               required>
                    </div>

                    <button type="button"
                            class="btn btn-primary"
                            onclick="confirmPasswordChange()">
                        Change Password
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- SweetAlert2 Dark (NO NEON / NO GLOW) -->
<style>
.swal2-popup {
    background: rgba(10, 10, 20, 0.95) !important;
    border-radius: 14px !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.65) !important; /* clean shadow */
    color: #e5e7eb !important;
    backdrop-filter: blur(8px);
}

.swal2-title {
    color: #ffffff !important;
    font-weight: 600;
}

.swal2-html-container {
    color: #cbd5e1 !important;
}

/* Flat icon (no neon) */
.swal2-icon.swal2-warning,
.swal2-icon.swal2-question {
    border-color: #9ca3af !important;
    color: #9ca3af !important;
}

.swal2-confirm {
    background: #f59e0b !important;
    color: #000 !important;
    border-radius: 8px !important;
    font-weight: 600;
}

.swal2-cancel {
    background: #374151 !important;
    color: #fff !important;
    border-radius: 8px !important;
}

.swal2-confirm:focus,
.swal2-cancel:focus {
    box-shadow: none !important;
}
</style>

<script>
/* PASSWORD MATCH VALIDATION */
const newPwd = document.getElementById('new_password');
const confirmPwd = document.getElementById('confirm_new_password');

function validatePasswordMatch() {
    if (newPwd.value !== confirmPwd.value) {
        confirmPwd.setCustomValidity('Passwords do not match');
    } else {
        confirmPwd.setCustomValidity('');
    }
}

if (newPwd && confirmPwd) {
    newPwd.addEventListener('input', validatePasswordMatch);
    confirmPwd.addEventListener('input', validatePasswordMatch);
}

/* PROFILE SAVE CONFIRMATION */
function confirmProfileSave() {
    const form = document.getElementById('profileForm');

    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    Swal.fire({
        title: 'Confirm Changes',
        text: 'Are you sure you want to save your profile changes?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, save changes',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            form.submit();
        }
    });
}

/* PASSWORD CHANGE CONFIRMATION */
function confirmPasswordChange() {
    const form = document.getElementById('passwordForm');

    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    Swal.fire({
        title: 'Are you sure?',
        text: 'You are about to change your password.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, change password',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            form.submit();
        }
    });
}
</script>
{% endblock %}
